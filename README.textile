h1. Factory Grabber

p. Factory grabber speeds up your tests by grabbing the nearest appropriate database records to suit your needs.

p. The idea is simple: most of the time, when using factories, you don't really care about the specific attributes, you just need a database record to play with. factory_grabber will _'grab'_ a matching record from the database if available or create any extra records if required. Less inserts to the database means faster tests.

p. At the moment, only "factory_girl":http://github.com/thoughtbot/factory_girl by thoughtbot is supported. If you'd like to see more factories supported please let me know (gavin@handyrailstips.com)

h2. To install:

h4. As a gem:

<pre>
sudo gem install git://github.com/GavinM/factory_grabber.git

# environment.rb
config.gem "thoughtbot-factory_girl", :lib => "factory_girl"
config.gem "factory_grbber", :version => ">=1.0.1", :lib => false
</pre>


h4. As a plugin:

<pre><code>script/plugin install git://github.com/GavinM/factory_grabber.git</code></pre>

h2. Example Usage

First, add the following line to *spec_helper.rb* or *test_helper.rb*:
<pre><code>require "factory_grabber"</code></pre>
To grab 1 comment:
<pre><code>@comment = Grab.a_comment</code></pre>

To grab 1 article:
<pre><code>@article = Grab.an_article</code></pre>

To grab 4 users named "John Smith":
<pre><code>@users = Grab.four_users(:first_name => "John", :last_name => "Smith")</code></pre>

Grab 73 users with standard factory attributes:
<pre><code>@users = Grab.seventy_three_users</code></pre>

h3. Practical examples:

In a controller spec:
<pre>
<code>
describe "GET /posts/1" do

  integrate_views

  before do
		# will create a record with these attributes if required, if not it will find the existing record
  	@post = Grab.one_post :title => "This is my first post", :body => "This is the post body"
  end
  
  def	do_get
  	get :show, :id => @post
  end
  
  it "should show the post title" do
  	do_get
  	response.should include_text(/This is my first post/)
  end

	it "should show the post body" do
		do_get
		response.should include_text(/This is the post body/)
	end
  
end


describe "GET /posts?page=1" do
	
	# testing pagination

	integrate_views
	
	before do
		# ensures there are at least eleven Post records
		# if there are less than eleven, new posts are created
		# if there are eleven or more no posts are created
		Grab.eleven_posts
	end
	
	def	do_get
		get :index, :page => 1
	end
	
	it "should find the latest 10 posts" do
		do_get
		assigns[:posts].should == Post.find(:all, :order => "created_at DESC", :limit => 10)
	end

end
</code>
</pre>

p. At the moment, all numbers between one and ninety_nine are supported. The general syntax for Grab methods is:

<pre>Grab.[number_in_words]_[factory_name]</pre>

h2. Performance

<pre>
Here's a quick example of the possible performance gains:

Rehearsal --------------------------------------------------------------
Create 50 new factories      0.130000   0.200000   0.330000 (  6.785332)
Grab 50 separate factories   0.320000   0.020000   0.340000 (  0.332814)
Grab 50 factories at once    0.010000   0.000000   0.010000 (  0.012414)
----------------------------------------------------- total: 0.680000sec

                                 user     system      total        real
Create 50 new factories      0.100000   0.200000   0.300000 (  6.354282)
Grab 50 separate factories   0.300000   0.000000   0.300000 (  0.310373)
Grab 50 factories at once    0.020000   0.000000   0.020000 (  0.011400)
</pre>

(These results can be produced for your own environment by running the file "performance_test.rb" in factory_grabber/lib/spec/performance_test.rb)

h2. Known Issues

At the moment, existing factories are found calling the model name. If your factory names do not match the name of the models then new factories will be created each time.
eg.
<pre>
	<code>
Factory(:admin_user, :class => :user) {	|f| f.admin(true) }

Grab.an_admin_user # => will not find records from the database.
	</code>
</pre>
h2. Feedback

p. This project is still an infant - if the Ruby community find it useful I plan on adding a lot more. Please send any ideas/feedback to gavin@handyrailstips.com


Free to upload, edit, share, fork etc.
"Gavin Morrice":http://gavinmorrice.com 2009<br />
"www.handyrailstips.com":http://handyrailstips.com